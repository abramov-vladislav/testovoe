# Основные инструменты и технологии

- Spring Boot — для создания REST API в обоих сервисах.
- Spring Data JPA — работа с PostgreSQL.
- Liquibase/Flyway — управление миграциями БД.
- Apache Kafka — асинхронное взаимодействие между службами.
- Docker — контейнеризация сервисов, PostgreSQL и Kafka.
- Spring Security (опционально) — для авторизации/аутентификации (если требуется).
- Spring Web — реализация REST-контроллеров.
- Swagger (SpringDoc OpenAPI) — документация API.
- Модель данных с агрегацией — для объединения полей пользователя в task-service.
- Реализация CQRS/Event Sourcing (частично) — синхронизация данных между сервисами через Kafka.

## Ход реализации тестового задания

### 1. Сервис пользователей (user-service)

**Основные модули**
- Model – сущности для базы данных.
- Repository – слой для взаимодействия с базой данных.
- Service – бизнес-логика.
- Controller – REST API.
- DTO (Data Transfer Objects) – объекты для передачи данных.
- Exception – обработка ошибок.
- Config – настройки Spring и Kafka.

**Написать UserController с методами:**
- GET /api/users — получить всех.
- GET /api/users/{id} — получить по ID.
- GET /api/users/by-username/{username} — получить по логину.
- PUT /api/users/{id} — редактировать (с проверкой уникальности username).

### 2. Сервис задач (task-service)
**Основные модули**
- Model – сущности для базы данных.
- Repository – слой для взаимодействия с базой данных.
- Service – бизнес-логика.
- Controller – REST API.
- DTO (Data Transfer Objects) – объекты для передачи данных.
- Exception – обработка ошибок.
- Config – настройки Spring и Kafka.

**Реализовать TaskController с методами:**
- GET /api/tasks — только задачи, где пользователь владелец/исполнитель.
- POST /api/tasks — создать задачу (проверка существования ownerId и executorId через локальный кеш).
- PUT /api/tasks/{id}/status — изменить статус (с проверкой прав).

**Добавить бизнес-логику в TaskService:**
Валидация прав доступа (владелец может всё, исполнитель — только определённые статусы).
Автоматическое обновление updatedAt при изменениях.

### 3. Интеграция и инфраструктура
   **Настроить Docker Compose для развертывания:**

```
services:
  postgres:
    image: postgres
  kafka:
    image: confluentinc/cp-kafka
  user-service:
    build: ./user-service
  task-service:
    build: ./task-service
  ```
    
**Добавить Swagger в оба сервиса:**


### Ключевые моменты
**Независимость сервисов:**
- task-service хранит только ownerId и executorId, но агрегирует данные о пользователях через 
локальный кеш (синхронизируется через Kafka).

**Авторизация:**
- Для проверки прав доступа передавать userId в заголовках запроса (например, X-User-Id).

**Документация:**
- В README.md описать команды для запуска (docker-compose up), эндпоинты Swagger.

SQL:
-- Создание схемы для task-service
CREATE SCHEMA IF NOT EXISTS task_service;

-- Создание типа ENUM для статуса задачи
CREATE TYPE task_service.task_status AS ENUM (
'NEW',           -- Новая задача
'ASSIGNED',      -- Задача назначена
'IN_PROGRESS',   -- Задача в процессе
'COMPLETED'      -- Задача выполнена
);

-- Создание таблицы для задач
CREATE TABLE IF NOT EXISTS task_service.tasks
(
task_id UUID PRIMARY KEY,                     -- Идентификатор задачи
task_name VARCHAR(255) NOT NULL,               -- Название задачи
task_owner_user_id UUID NOT NULL,              -- Идентификатор владельца задачи (пользователь)
task_executor_user_id UUID NOT NULL,           -- Идентификатор исполнителя задачи (пользователь)
task_status task_service.task_status,          -- Статус задачи (ENUM: NEW, ASSIGNED, IN_PROGRESS, COMPLETED)
task_create_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- Дата и время создания задачи
task_update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,  -- Дата и время последнего обновления задачи
CONSTRAINT fk_owner FOREIGN KEY (task_owner_user_id) REFERENCES user_service.users(user_id) ON DELETE CASCADE, -- Внешний ключ на владельца
CONSTRAINT fk_executor FOREIGN KEY (task_executor_user_id) REFERENCES user_service.users(user_id) ON DELETE CASCADE  -- Внешний ключ на исполнителя
);



