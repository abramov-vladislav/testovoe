# Основные инструменты и технологии

- Spring Boot — для создания REST API в обоих сервисах.
- Spring Data JPA — работа с PostgreSQL.
- Liquibase/Flyway — управление миграциями БД.
- Apache Kafka — асинхронное взаимодействие между службами.
- Docker — контейнеризация сервисов, PostgreSQL и Kafka.
- Spring Security (опционально) — для авторизации/аутентификации (если требуется).
- Spring Web — реализация REST-контроллеров.
- Swagger (SpringDoc OpenAPI) — документация API.
- Модель данных с агрегацией — для объединения полей пользователя в task-service.
- Реализация CQRS/Event Sourcing (частично) — синхронизация данных между сервисами через Kafka.

## Ход реализации тестового задания

### 1. Сервис пользователей (user-service)

**Создать сущность User:**

```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    @Column(unique = true)
    private String username;
    private String firstName;
    private String lastName;
}
```
**Реализовать UserRepository с методами:**

```java
public interface UserRepository extends JpaRepository<User, Long> {
    Optional<User> findByUsername(String username);
}
```
**Написать UserController с методами:**
- GET /api/users — получить всех.
- GET /api/users/{id} — получить по ID.
- GET /api/users/by-username/{username} — получить по логину.
- PUT /api/users/{id} — редактировать (с проверкой уникальности username).

**Добавить кастомную валидацию в UserService для проверки уникальности логина при редактировании.**

**Настроить Liquibase/Flyway для миграций таблицы users.**

### 2. Сервис задач (task-service)
Создать сущность Task:

```java
@Entity
public class Task {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String title;
    private Long ownerId; // ID владельца (из user-service)
    private Long executorId; // ID исполнителя (из user-service)
    @Enumerated(EnumType.STRING)
    private TaskStatus status;
    private LocalDateTime createdAt;
    private LocalDateTime updatedAt;
}
```
**Создать DTO для ответа с агрегацией данных о пользователях:**

```java
public class TaskResponse {
    private Long id;
    private String title;
    private String ownerInfo; // "username: firstName lastName"
    private String executorInfo;
    private TaskStatus status;
}
```
**Реализовать TaskRepository с методами:**

```java
public interface TaskRepository extends JpaRepository<Task, Long> {
    List<Task> findByOwnerId(Long ownerId);
    List<Task> findByExecutorId(Long executorId);
}
```
**Настроить взаимодействие с user-service через Kafka:**

- При изменении пользователя в user-service отправлять событие в Kafka (например, UserUpdatedEvent).
- В task-service подписаться на топик Kafka и обновлять локальный кеш пользователей (если требуется).
**Реализовать TaskController с методами:**

- GET /api/tasks — только задачи, где пользователь владелец/исполнитель.
- POST /api/tasks — создать задачу (проверка существования ownerId и executorId через локальный кеш).
- PUT /api/tasks/{id}/status — изменить статус (с проверкой прав).
- Добавить бизнес-логику в TaskService:

Валидация прав доступа (владелец может всё, исполнитель — только определённые статусы).
Автоматическое обновление updatedAt при изменениях.
### 3. Интеграция и инфраструктура
   **Настроить Docker Compose для развертывания:**

```java
services:
  postgres:
    image: postgres
  kafka:
    image: confluentinc/cp-kafka
  user-service:
    build: ./user-service
  task-service:
    build: ./task-service
```
**Добавить Swagger в оба сервиса:**

```java
@Configuration
public class SwaggerConfig {
    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI().info(new Info().title("Task Service API"));
    }
}
```
**Реализовать обработку ошибок (например, 409 Conflict при дублировании логина).**

### Ключевые моменты
**Независимость сервисов:**
- task-service хранит только ownerId и executorId, но агрегирует данные о пользователях через 
локальный кеш (синхронизируется через Kafka).

**Авторизация:**
- Для проверки прав доступа передавать userId в заголовках запроса (например, X-User-Id).

**Документация:**
- В README.md описать команды для запуска (docker-compose up), эндпоинты Swagger.
